<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Audio Validation • Levante</title>
	<link rel="stylesheet" href="./styles.css">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
	<style>
		.page-container { padding: 16px; }
		.panel { background:#fff; border-radius:10px; box-shadow:0 4px 12px rgba(0,0,0,0.1); padding:16px; resize:both; overflow:auto; min-height:300px; }
		.panel-header { display:flex; align-items:center; gap:10px; justify-content:space-between; margin-bottom:10px; cursor:default; }
		.panel-title { font-size:18px; font-weight:700; color:#333; display:flex; align-items:center; gap:8px; }
		.controls { display:flex; align-items:center; gap:10px; flex-wrap:wrap; }
		.data-table { width:100%; border-collapse:collapse; font-size:12px; }
		.data-table th { background:#4facfe; color:#fff; padding:8px; text-align:left; position:sticky; top:0; }
		.data-table td { padding:8px; border-bottom:1px solid #eee; vertical-align:top; }
		.data-table tr:hover { background:#f8f9fa; }
		.audio-path { font-family:monospace; font-size:11px; color:#6c757d; }
		.text-cell { white-space:normal; word-wrap:break-word; }
		.badge { padding:2px 6px; border-radius:12px; font-size:11px; background:#eef; color:#334; }
	</style>
</head>
<body>
	<div class="page-container">
		<div class="panel" id="audio-validation-panel">
			<div class="panel-header">
				<div class="panel-title"><i class="fas fa-wave-square"></i> Audio Validation</div>
				<div class="controls">
					<label for="validationFile">Results file:</label>
					<select id="validationFile" v-model="selectedFile" @change="loadSelected">
						<option v-for="f in files" :key="f" :value="f">{{ f }}</option>
					</select>
					<button class="btn btn-info btn-compact" @click="loadSelected"><i class="fas fa-folder-open"></i> Load</button>
					<span class="badge" v-if="summary">Lang: {{ displayLang || '—' }}</span>
					<span class="badge" v-if="voiceName">Voice: {{ voiceName }}</span>
					<span class="badge" v-if="summary">Count: {{ summary.count }}</span>
					<span class="badge" v-if="summary">Avg: {{ (summary.avg*100).toFixed(1) }}%</span>
				</div>
			</div>
			<div v-if="error" style="color:#b71c1c; margin-bottom:8px;">{{ error }}</div>
			<div style="border:1px solid #eee; border-radius:8px; overflow:auto; max-height:70vh;">
				<table class="data-table" style="table-layout: fixed;">
					<colgroup>
						<col style="width: 15%">
						<col style="width: 10%">
						<col style="width: 30%">
						<col style="width: 30%">
						<col style="width: 7%">
						<col style="width: 8%">
					</colgroup>
					<thead>
						<tr>
							<th @click="setSort('filename')" style="cursor:pointer">filename</th>
							<th @click="setSort('similarity')" style="cursor:pointer">similarity_ratio</th>
							<th>expected</th>
							<th>transcribed</th>
							<th>play</th>
							<th>regen</th>
						</tr>
					</thead>
					<tbody>
						<tr v-for="r in sortedRows" :key="r.audio_path">
							<td class="audio-path">{{ r.filename }}</td>
							<td>{{ (r.basic_metrics?.similarity_ratio ?? 0).toFixed(3) }}</td>
							<td class="text-cell">{{ r.expected_text }}</td>
							<td class="text-cell">{{ r.transcribed_text }}</td>
							<td><button class="btn btn-primary btn-compact" @click="playRow(r)" title="Play existing"><i class="fas fa-play"></i></button></td>
							<td><button class="btn btn-success btn-compact" @click="regenAndPlay(r)" title="Regenerate & Play"><i class="fas fa-magic"></i></button></td>
						</tr>
					</tbody>
				</table>
			</div>
		</div>
	</div>
	<script src="https://unpkg.com/vue@3.4.21/dist/vue.global.prod.js"></script>
	<script src="./config.js"></script>
	<script src="./js-compiled/utils.js"></script>
	<script src="./js-compiled/credentials.js"></script>
	<script src="./js/audio-validation-page.js?v=2"></script>
</body>
</html>
